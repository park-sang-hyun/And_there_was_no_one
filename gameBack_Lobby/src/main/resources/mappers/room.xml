<?xml version="1.0" encoding="UTF-8"?>
<!-- mappers/hrm.xml -->
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
                        
<mapper namespace="room_mapper"> <!-- mybatis는 namespace필수!! -->
     <select id="selectAll" resultType="room">
		select * from room where 1=1
     </select>

     <insert id="create" useGeneratedKeys="true" keyProperty="id">
    	insert into room(title, max_count, cur_count, mode, difficulty, start) 
    	values(#{title},#{max_count},#{cur_count},#{mode},#{difficulty},#{start})
     </insert>
     
     <insert id="connectUser" parameterType="com.ssafy.pjt3.dto.UserRoom">
    	insert into userroom(leader, user_id, room_id) 
    	values(#{leader},#{user_id},#{room_id})
     </insert>
     
     <select id="findRoomPkId" resultType="int">
		select room_id from userroom where user_id=#{user_id}
     </select>
     
     <select id="findUserInRoom" resultType="com.ssafy.pjt3.dto.User">
		select u.id, u.username, u.nickname, u.password, u.playcount, u.wincount, u.score
		from userroom as ur
		join user as u
		on ur.user_id = u.id;
     </select>
     
     <update id="takeLeader">
     	update userroom 
     	set leader = 1
     	where user_id=#{user_id}
     </update>
     
     <update id="giveLeader">
     	update userroom 
     	set leader = 0
     	where user_id=#{user_id}
     </update>
     
     <delete id="leaveRoom" >
       delete from userroom where user_id = #{user_id}    
     </delete>
     
     <delete id="deleteRoom" >
       delete from room where id = #{room_id}    
     </delete>
    
    <update id="update" >
    	update room set title =    	
    	<if test="title != null">
    		#{title}
    	</if>               
    	<if test="title == null">
    		title
    	</if>
    	, max_count =
    	<if test="max_count != null">
    		#{max_count}
    	</if>               
    	<if test="max_count == null">
    		max_count
    	</if>
    	, mode = 
    	<if test="mode != null">
    		#{mode}
    	</if>               
    	<if test="mode == null">
    		mode
    	</if>
    	, difficulty = 
    	<if test="difficulty != null">
    		#{difficulty}
    	</if>               
    	<if test="difficulty == null">
    		difficulty
    	</if>
    	
    	where id = #{id}
    </update>
    
    <delete id="delete" >
       delete from room where id = #{id}    
    </delete>

</mapper>



